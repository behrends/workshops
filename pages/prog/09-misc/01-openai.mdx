import { Callout } from 'nextra/components';

# OpenAI API

In Moodle steht jedem Team ein API-Key für die 
OpenAI-Plattform zur Verfügung. Dieser kann in
der Datei `.env` hinterlegt werden:

## API-Key in `.env` speichern

Erstellen Sie im Projektverzeichnis eine Datei `.env`
und fügen Sie den OpenAI-API-Key Ihrer Gruppen wie folgt ein:

```plaintext
OPENAI_API_KEY=sk-...
```

In der Datei `.env` werden in der Regel Umgebungsvariablen 
und geheime Schlüssel in Node.js-Projekten gespeichert. 
Diese Datei ist in der Standardkonfiguration des 
Datei-Explorers (Windows) oder Finder (Mac) nicht sichtbar.

Die Datei `.env` wird nicht dem Git-Repository hinzugefügt,
da sie geheime Informationen enthält. Dies wird durch
die Datei `.gitignore` sichergestellt.

```
# Folgende Zeile muss in .gitignore stehen
.env
```

<Callout type="error" emoji="❗️">
Bitte achten Sie darauf, dass der API-Key nicht
öffentlich zugänglich ist und dass der oben beschriebene
Eintrag in der `.gitignore`-Datei vorhanden ist.
</Callout>

## OpenAI API nutzen

Die OpenAI API kann in Node.js-Projekten wie folgt
eingebunden werden. Im Projektverzeichnis muss dieses
Terminal-Kommando ausgeführt werden, um die Hilfsbibliothek
von OpenAI zu installieren:

```bash
npm install openai
```

Anschließend kann die API in einem Node.js-Programm
wie folgt verwendet werden. Dazu muss die Klasse `OpenAI`
aus der Hilfsbibliothek importiert und ein entsprechendes 
Objekt initialisiert werden. Es folgt auch ein Beispiel
für die Verwendung der Chat-API von OpenAI:

```javascript
import OpenAI from 'openai';

// OpenAI initialisieren (API-Key aus .env-Datei wird geladen)
const openai = new OpenAI();

// hier könnte eine Eingabe erfolgen hier „simuliert“ mit einer Variablen
let input = 'Hauptstadt der Schweiz';

const completion = await openai.chat.completions.create({
  messages: [
    {
      role: 'developer',
      content:
        'Du bekommst Beschreibungen von Orten und lieferst nur die passende Stadt. Wenn du keine Stadt findest, dann antwortest du mit "no result". Sonst gibst du mir keine weiteren Texte.',
    },
    { role: 'user', content: input },
  ],
  model: 'gpt-4o-mini',
});
const searchResult = completion.choices[0].message.content;
console.log('Ergebnis der KI-Suche:', searchResult);
```

## Programm mit `.env`-Datei starten 

Wir müssen nun dafür sorgen, dass die Umgebungsvariablen
aus der Datei `.env` in unserem Programm geladen werden.
Dazu kann in der Datei `package.json` ein `scripts`-Eintrag
erstellte werden:

```
{
  "name": "openai-example",
  "version": "1.0.0",
  "main": "main.js",
  "type": "module",
  "scripts": {
    "start": "node --env-file=.env main.js",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  // usw.
}
```

Dies ermöglicht den Start des Programms mit dem Befehl

```bash
npm start
```

Dabei wird der entsprechende Eintrag in `scripts` in 
der Datei `package.json` ausgeführt. Bei uns ist
dies der Befehl `node --env-file=.env main.js`, womit
aus `.env` die Umgebungsvariablen geladen werden und 
das Programm `main.js` gestartet wird.

Mehr Infos gibt es in der Dokumentation der (umfangreichen!) API 
von OpenAI, z.B. für die Arbeit mit Text: https://platform.openai.com/docs/guides/text-generation

&rarr; Bei den Code-Beispielen `javascript` auswählen.