import { Callout } from 'nextra/components';

# Git-Konflikte l√∂sen

<Callout type="info" emoji="üë®üèª‚Äçüíª">
Infos f√ºr Dozent: 

Dies wird mit zwei verschiedenen GitHub-Accounts gezeigt. 

- GitHub-Projekt erstellen (`ErsterBenutzer/Repository.git`)
- zweiten GitHub-Account als _Collaborator_ hinzuf√ºgen
- erster GitHub-Account klont das Projekt auf dem Rechner

Vorher checken: F√ºr den zweiten GitHub-Account muss ein SSH-Key auf GitHub vorliegen und lokal in `~/.ssh/config` angepasst werden:

```
Host github-other
    HostName github.com
    User git
    IdentityFile ~/.ssh/id_rsa_other
    IdentitiesOnly yes
```

Als zweiter GitHub-User das Projekt des ersten Nutzers klonen:

```
git clone git@github-other:ErsterBenutzer/Repository.git Projektordner
```

- Lokale Git-Config im Projektordner f√ºr zweiten GitHub-Account setzen:

```
cd projektordner
git config user.name "Anderer Benutzer"
git config user.email "andere-email@example.com"
```

&rarr; Nun kann der zweite GitHub-Account lokal √Ñnderungen vornehmen und pushen.
</Callout>

Wir spielen nun verschiedene Szenarios durch:

- √Ñnderungen pushen und pullen (ohne Konflikte)
- √Ñnderungen im GitHub-Repo, die noch nicht lokal sind:
  - Push schl√§gt fehl (weil √Ñnderungen im Repo)
  - Merge-Strategie in config festlegen
  - Pull mit automatischem Merge und anschlie√üenden Push
- Merge-Konflikte behandeln

## √Ñnderungen pushen und pullen (ohne Konflikte)

Ablauf:

- Erster Benutzer √§ndert und committed Datei1 und pusht
- Zweiter Benutzer pullt die √Ñnderungen
- Zweiter Benutzer √§ndert und committed Datei2 und pusht
- Erster Benutzer pullt die √Ñnderungen
- usw.

&rarr; Keine Konflikte, alles l√§uft glatt, weil die √Ñnderungen nacheinander geschehen und sich nicht √ºberschneiden.

## √Ñnderungen im GitHub-Repo, die noch nicht lokal sind

Ablauf:

- Erster Benutzer √§ndert und committed Datei1 und pusht
- Zweiter Benutzer √§ndert und committed Datei2 und versucht zu pushen

&rarr; Push schl√§gt fehl, weil √Ñnderungen im Repo sind, die noch nicht lokal sind.

- Zweiter Benutzer muss die √Ñnderungen zuerst pullen, bevor er pushen kann.

&rarr; Sowohl im Terminal als auch in VS Code erscheint folgender Fehler:

```
hint: You have divergent branches and need to specify how to reconcile them.
hint: You can do so by running one of the following commands sometime before
hint: your next pull:
hint:
hint:   git config pull.rebase false  # merge
hint:   git config pull.rebase true   # rebase
hint:   git config pull.ff only       # fast-forward only
hint:
hint: You can replace "git config" with "git config --global" to set a default
hint: preference for all repositories. You can also pass --rebase, --no-rebase,
hint: or --ff-only on the command line to override the configured default per
hint: invocation.
```

Der zweite Benutzer muss die Merge-Strategie festlegen, bevor er pullt.
Wir verwenden `git config pull.rebase false` f√ºr einen Merge, weil
dies am einfachsten zu verstehen ist. 

Im Terminal ausf√ºhren: 

```bash
git config pull.rebase false
```

Danach klappt das Pullen, und die √Ñnderungen k√∂nnen automatisch gemerged 
werden, weil sie sich nicht √ºberschneiden. Dennoch ist ein lokaler Commit
der √Ñnderungen n√∂tig.

&rarr; Nach dem Commit kann der zweite Benutzer pushen.

&rarr; √Ñnderungen mit `git log` anzeigen (`Merge branch 'main' of‚Ä¶`)

<br/>

<mark>Das Festlegen der Merge-Strategie muss jedes Teammitglied einmal f√ºr das Projekt durchf√ºhren.</mark>

## Merge-Konflikte behandeln

Wir zeigen nun, was passiert, wenn in einer Datei √Ñnderungen vorgenommen werden, die sich √ºberschneiden (z.B. in der Datei `README.md`).

- Erster Benutzer √§ndert `README.md` in Zeile X, committed und pusht
- Zweiter Benutzer √§ndert `README.md` auch in Zeile X und committed dies lokal
- Zweiter Benutzer pusht, was fehlschl√§gt, und pullt die √Ñnderungen

&rarr; Es kommt zu einem Merge-Konflikt, weil die √Ñnderungen sich √ºberschneiden, dazu erscheint folgende Meldung im Terminal:

```
Auto-merging README.md
CONFLICT (content): Merge conflict in README.md
Automatic merge failed; fix conflicts and then commit the result.
```

Wir sehen mit `git status` folgenden Zustand im lokalen Repository:

```
You have unmerged paths.
  (fix conflicts and run "git commit")
  (use "git merge --abort" to abort the merge)

Unmerged paths:
  (use "git add <file>..." to mark resolution)
	both modified:   README.md
```

Nun m√ºssen wir die Konflikte in der Datei `README.md` manuell l√∂sen,
dort werden die Konflikte direkt in der Datei markiert:

```
Hier steht der Rest des Readme-Textes‚Ä¶

<<<<<<< HEAD
√Ñnderung des zweiten Benutzers
=======
√Ñnderung von Benutzer1
>>>>>>> 893fd404c23f6ee0f04f8693210320e8fa0845cc
```

Unsere √Ñnderungen (Benutzer2) stehen zwischen `<<<<<<< HEAD` und 
`=======`, die √Ñnderungen des ersten Benutzers zwischen `=======` und 
`>>>>>>>`. Wir m√ºssen die Konflikte manuell aufl√∂sen, indem wir die 
gew√ºnschten √Ñnderungen in der Datei behalten und den Rest l√∂schen.
Die Markierungen werden auch gel√∂scht:

```
Hier steht der Rest des Readme-Textes‚Ä¶

√Ñnderung von Benutzer1
```

Hier haben wir die √Ñnderungen des ersten Benutzers behalten und die
des zweiten Benutzers gel√∂scht. Nun k√∂nnen wir mit `git add` und 
`git commit` die √Ñnderungen abschlie√üen.

<br/>

<mark>&rarr; Danach spielen wir das gleiche Szenario in VS Code durch.</mark>

In VS Code k√∂nnen wir genau wie im Terminal vorgehen oder die von
den Git-Tools bereitgestellten Funktionen nutzen. 

## Abschlie√üende Bemerkungen

Wir haben nur die wichtigsten Befehle im Umgang mit Git 
und GitHub kennengelernt, um gemeinsam an einem Projekt
zu arbeiten. Es gibt viele weitere Befehle und 
M√∂glichkeiten, Git und GitHub zu nutzen. Mehr Infos 
zu Git:

- Dokumentation bei GitHub: https://docs.github.com/de/get-started/start-your-journey/git-and-github-learning-resources
- Online-Buch "Pro Git": https://git-scm.com/book/de/v2
- Git-Tutorial (Video, 40 min): https://www.youtube.com/watch?v=uGLQF2kUwOA&t
- ChatGPT und andere KI-Chats k√∂nnen Git erkl√§ren und insbesondere Fragen in bestimmten Situationen beantworten.


<Callout>
Es gib viele Tools f√ºr die Arbeit mit Git und GitHub, z.B.
bietet GitHub auch einen [Desktop-Client](https://desktop.github.com/) an. Manche
</Callout>