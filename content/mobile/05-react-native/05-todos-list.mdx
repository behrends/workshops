import { Callout, Tabs } from 'nextra/components';

# Liste mit Todos

<Callout>
  **Dauer:** 20 Minuten

  - Daten in einem lokalen Array 
  - FlatList einbinden
  - √úbung: FlatList in eigener Datei
  - √úbung: FlatList stylen
</Callout>

<Callout type="info">
**Vorstellung des Frameworks**

- [x] Installation und Einrichtung der Entwicklungsumgebung
- [x] Prinzipien des Frameworks (Projektstruktur, Komponenten/Widgets, ‚Ä¶)
- [ ] App mit einem Screen: UI-Elemente, Layout, Interaktion und State
- [ ] Daten lokal speichern
- [ ] Navigation zwischen mehreren Screens

</Callout>

## Daten in einem lokalen Array

In fast jeder App werden Daten verwaltet, in unserem Beispiel sind dies u.a. die Todos. Je nach Umfang und Komplexit√§t der Daten wird daf√ºr auf l√§ngere Sicht eine Datenbank oder eine andere Form der persistenten Speicherung ben√∂tigt. 

Zun√§chst konzentrieren wir uns auf das UI und werden noch keine Datenbank in unserer App einsetzen. Dennoch macht es Sinn, im Code die Daten vom UI zu trennen, damit eine sp√§tere Einbindung einer Datenbank leichter umzusetzen ist. Hierzu definieren wir ein einfaches Array bestehend aus Strings und weisen dies einer Konstanten au√üerhalb der Funktionskomponente zu:

```jsx {1}
const todos = ['Einkaufen', 'Sport', 'React Native lernen'];

export default function App() {
  return (
    <View style={styles.container}>
      <Todo>Einkaufen</Todo>
      <Todo>Sport</Todo>
      <Todo>React Native lernen</Todo>
      <StatusBar style="auto" />
    </View>
  );
}
```

Nun k√∂nnen wir die Todos aus dem `todos`-Array verwenden, indem mir mit der Array-Funktion `map` zu jedem String die passende `<Todo>`-Komponente erstellen:

```jsx {6-8}
const todos = ['Einkaufen', 'Sport', 'React Native lernen'];

export default function App() {
  return (
    <View style={styles.container}>
      {todos.map((todo) => (
        <Todo>{todo}</Todo>
      ))}
      <StatusBar style="auto" />
    </View>
  );
}
```

Dabei sind die geschweiften Klammern im JSX-Code zu beachten, welche die Verwendung von JavaScript-Code signalisieren.

<Callout type="info">
Bei Bedarf kann die Funktionsweise von `map` und  Pfeilfunktionen in JavaScript kurz erl√§utert werden (JavaScript-Code in der Browser-Konsole, Whiteboard, ChatGPT, ‚Ä¶).
</Callout>

## Todos als JavaScript-Objekte

Wir erhalten nun diese Warnung in der App:

![Warnung bei fehlendem key-prop](/images/mobile/reactnative/key-prop-warning.png)

Wenn React (Native) iterativ mehrere Komponenten als eine Art Liste erzeugt, dann wird erwartet, 
dass jede Komponente eindeutig identifizierbar ist. Dies wird zu Optimierungszwecken ben√∂tigt, 
wenn sich z.B. die Reihenfolge in der Liste √§ndert. In React (Native) wird dazu in jeder Komponente 
ein `key`-prop mit einem eindeutigen Wert definiert, wie hier angedeutet:

```jsx
<Todo key={id}>{todo}</Todo>
```

<Callout>
Neben `key` gibt es weitere ‚Äûreservierte‚Äú Props, die nicht f√ºr eigene Zwecke genutzt werden sollten (u.a. `ref`).
</Callout>

Um diese Anforderung in unserer App zu erf√ºllen, k√∂nnten wir die Todos im Array als 
JavaScript-Objekte mit eindeutigen Werten in einer `id`-Eigenschaft deklarieren:

```jsx {2-4} /key={todo.id}/
const todos = [
  { id: 1, text: 'Einkaufen' },
  { id: 2, text: 'Sport' },
  { id: 3, text: 'React Native lernen' },
];

export default function App() {
  return (
    <View style={styles.container}>
      {todos.map((todo) => (
        <Todo key={todo.id}>{todo.text}</Todo>
      ))}
      <StatusBar style="auto" />
    </View>
  );
}
```

Wichtig ist, dass die `Todo`-Komponenten nun passend zu den JavaScript-Objekten im Array 
deklariert werden, d.h. auf den Text des Todo-Objekts muss nun mit `todo.text` zugeriffen
werden. Zus√§tzlich setzen wir `key`-Prop mit der ID:

```jsx
<Todo key={todo.id}>{todo.text}</Todo>
```

Damit sollte die Warnung verschwinden.

## FlatList einbinden

React Native stellt mit `FlatList` eine Komponente bereit, mit der beliebig viele Elemente in einer scrollbaren Liste dargestellt werden k√∂nnen. Um `FlatList` zu verwenden, sind folgende Schritte n√∂tig:

- `FlatList` importieren.
- Nun kann `<FlatList/>` als Komponente im JSX-Code mit mindestens den Props `data` und `renderItem` verwendet werden.
- Im Prop `data` ist ein Array mit Listenelementen zu definieren.
- Dem Prop `renderItem` wird eine Funktion √ºbergeben, die eine Komponente zur Darstellung eines Listeneintrags liefert (wird automatisch f√ºr jedes Element in `data` aufgerufen).
- Bei Bedarf f√ºr die `FlatList` Abstand zum oberen Bildschirmrand mit `paddingTop` definieren.

Wir k√∂nnen unsere App mit `FlatList` wie folgt umschreiben:

```jsx {1,13-18}
import { FlatList, StyleSheet, View } from 'react-native';
import Todo from './components/Todo';

const todos = [
  { id: 1, text: 'Einkaufen' },
  { id: 2, text: 'Sport' },
  { id: 3, text: 'React Native lernen' },
];

export default function App() {
  return (
    <View style={styles.container}>
      <FlatList
        data={todos}
        renderItem={({ item }) => (
          <Todo key={item.id}>{item.text}</Todo>
        )}
      />
      <StatusBar style="auto" />
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#fff',
    alignItems: 'center',
    justifyContent: 'center',
    paddingTop: 50, // <-- Abstand zum oberen Bildschirmrand
  },
});
```

Zur Laufzeit wird die Funktion im Prop `renderItem` automatisch f√ºr jedes Element des Arrays aufgerufen, das im Prop `data` √ºbergeben wird. Die Funktion in `renderItem` erh√§lt ein Objekt als Parameter, dessen Eigenschaft `item` das anzuzeigende Array-Element enth√§lt. Im Code-Beispiel wird dies mit `{ item }` destrukturiert.

Zu beachten ist auch der Abstand zum oberen Bildschirmrand, den wir mit `paddingTop: 50` im `style`-Objekt festlegen, damit die Liste komplett sichtbar ist.

<Callout type="important">
Unterschiedliche Displaygr√∂√üen auf iPhones und Android-Ger√§ten mit
verschiedenen Eigenschaften wie z.B. iPhone-Notch, Safe Area und 
Status Bar erfordern oft eine genauere Behandlung des Abstands zum 
oberen Bildschirmrand.

Ein Beispiel einer plattform√ºbergreifenden L√∂sung ist das Package 
[react-native-safe-area-context](https://docs.expo.dev/versions/latest/sdk/safe-area-context/)

Infos zur Verwendung in Expo-Apps:
https://docs.expo.dev/versions/latest/sdk/safe-area-context/

```bash
npx expo install react-native-safe-area-context
```

Wenn wir in unserer App `SafeAreaView` als √§u√üerste Komponente
im UI-Baum verwenden, dann wird der Abstand zum oberen Bildschirmrand
automatisch korrekt gesetzt:

```jsxjsx
import { SafeAreaView } from 'react-native-safe-area-context';

// restlicher Code unver√§ndert

export default function App() {
  return (
    <SafeAreaView style={styles.container}>
      <FlatList
        data={todos}
        renderItem={({ item }) => (
          <Todo key={item.id}>{item.text}</Todo>
        )}
      />
      <StatusBar style="auto" />
    </SafeAreaView>
  );
}
```
</Callout>

## √úbung: FlatList in eigener Datei

Erstellen Sie eine eigene Komponente `TodoList` f√ºr die `FlatList` in einer neuen Datei `components/TodoList.jsx` und verwenden Sie diese in `App.js`.

<Tabs items={['L√∂sung:', 'üëá']}>
  <Tabs.Tab>üëâ</Tabs.Tab>
  <Tabs.Tab>
  ```jsx
// components/TodoList.jsx
import { FlatList } from 'react-native';
import Todo from './Todo';

export default function TodoList({ todos }) {
  return (
    <FlatList
      data={todos}
      renderItem={({ item }) => (
        <Todo key={item.id}>{item.text}</Todo>
      )}
    />
  );
}
  ```

  ```jsx
// App.jsx
import TodoList from './components/TodoList';

// const todos = ...

export default function App() {
  return (
    <SafeAreaView style={styles.container}>
      <TodoList todos={todos} />
      <StatusBar style="auto" />
    </SafeAreaView>
  );
}

// styles weggelassen

  ```
  </Tabs.Tab>
</Tabs>

## √úbung: FlatList stylen

Erg√§nzen Sie die `TodoList`-Komponente mit Styles, sodass die Liste auf den ganzen Bildschirm ausgedehnt wird und linksb√ºndig erscheint.

Recherchieren Sie au√üerdem in der Dokumentation zu `FlatList` (https://reactnative.dev/docs/flatlist), wie Sie mit dem `FlatList`-Prop namens `ItemSeparatorComponent` einen Trennstrich zwischen zwei Todos in der Liste anzeigen k√∂nnen:

![FlatList mit Trennstrich](/images/mobile/reactnative/FlatList-styles.png)

<Tabs items={['L√∂sung:', 'üëá']}>
  <Tabs.Tab>üëâ</Tabs.Tab>
  <Tabs.Tab>
  ```jsx
import { FlatList, StyleSheet, View } from 'react-native';
import Todo from './Todo';

export default function TodoList({ todos }) {
  return (
    <FlatList
      style={styles.list}
      data={todos}
      renderItem={({ item }) => (
        <Todo key={item.id}>{item.text}</Todo>
      )}
      ItemSeparatorComponent={() => <View style={styles.separator} />}
    />
  );
}

const styles = StyleSheet.create({
  list: {
    width: '100%',
  },
  separator: {
    height: StyleSheet.hairlineWidth,
    backgroundColor: 'darkgrey',
  },
});
  ```
  </Tabs.Tab>
</Tabs>

## PAUSE?