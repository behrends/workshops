import { Callout } from 'nextra/components'

# Kotlin Multiplatform (KMP)

<Callout>
  **Dauer:** 45 Minuten 

  - Infos zu KMP

  **Ziel:** Motivation und Einstieg in KMP
</Callout>

Kotlin Multiplatform (KMP) ist ein Framework zur plattformübergreifenden
Entwicklung von Apps mit Kotlin. Ursprünglich gedacht für die gemeinsame Nutzung von
Geschäftslogik und anderen Teilen des Codes zwischen verschiedenen
Plattformen wie Android und iOS, können inzwischen auch komplette Apps inklusive UI mit KMP entwickelt werden. Somit kann KMP als vollständiges Framework zur plattformübergreifenden
App-Entwicklung angesehen werden.

Dahinter steckt Jetbrains aber auch Google unterstützt offiziell KMP, wie an verschiedenen
Stellen in der Android-Dokumentation zu sehen ist.

Kotlin Multiplatform für geteilte Geschäftlogik und Compose Multiplatform UI Framework für plattformübergreifende UI.

https://www.jetbrains.com/kotlin-multiplatform/

## Setup in Android Studio

KMP-Projekte lassen sich ähnlich wie native Android-Projekte mit Android Studio entwickeln. Dafür muss nichts zusätzlich installiert werden. 

Das KMP-Plugin ist optional, wird aber benötigt, um die App unter macOS auf einem 
iPhone-Simulator auszuführen (Stand 2025: nur macOS unterstützt).

Webseite des KMP-Plugins: https://plugins.jetbrains.com/plugin/14936-kotlin-multiplatform


## App erstellen 

- macOS: Neues Projekt mit Template „Kotlin Multiplatform“ erstellen.
- Windows/Linux: KMP-Projekt im Web erstellen (https://kmp.jetbrains.com), herunterladen und in Android Studio öffnen.

Offizielle Anleitung: https://www.jetbrains.com/help/kotlin-multiplatform-dev/quickstart.html

## App starten

Die Android-Version der App kann wie gewohnt in Android Studio auf einem Emulator oder einem physischen Gerät gestartet werden.

Um die iOS-Version der App zu starten ist ein Mac mit Xcode erforderlich. &rarr; auf Wunsch vorführen.

## Grundlegende Konzepte 

Diese erklären wir an dem Code, der für uns generiert wurde. Dies ist in der Regel eine kleinere App. 

Vieles ist sehr ähnlich wie in der nativen Android-Entwicklung mit Kotlin und Jetpack Compose. 

### Projektstruktur und Ausgangscode

In einer KMP-App liegt der plattformübergreifende Code unter `composeApp/src/commonMain`.

Für plattformspezifischen Code gibt es entsprechend eigene Ordner.

Die `MainActivity` in `composeApp/src/androidMain/` wird nicht angepasst, stattdessen 
fügen wir unsere Änderungen in der `App.kt` in `composeApp/src/commonMain/` durch.

In `App.kt` sehen wir u.a., dass das `MaterialTheme` und kein eigenes Theme verwendet wird.

### Code der Android-App auf KMP migrieren

In `commonMain` erstellen mir zwei Verzeichnisse bzw. `data` und `ui`.

Dann kopieren wir den Code aus `ui` (`AddTodoDialog` und `TodosViewModel`) und `data` (`Todo`) 
der zuvor gebauten Android-App in die entsprechenden Verzeichnisse der KMP-App.

Danach müssen wir die `package`-Deklaration und die `imports` anpassen.

Aus der `MainActivity` der Android-App kopieren wir die folgenden Funktionen bzw. Composables: 

- `TodosApp`
- `TodoItem`
- `TodoList`

und fügen diese in `App.kt` der KMP-App ein.

Wir benennen `App` der KMP-App in `OldApp und die kopierte `TodosApp` in `App` um.  
Außerdem stellen wir in der kopierten App das Theme auf `MaterialTheme` um.

Danach die imports anpassen bzw. mit `Alt-Enter` hinzufügen.

`FloatingActionButton` &rarr; `ExtendedFloatingActionButton` um das Icon loszuwerden bzw.
durch Text zu ersetzen (`Text("Neues Todo")`).

- https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-integrate-in-existing-app.html
- https://www.jetbrains.com/help/kotlin-multiplatform-dev/faq.html#i-have-an-existing-android-application-that-uses-jetpack-compose-what-should-i-do-to-migrate-it-to-other-platforms


&rarr; Wer mit KMP arbeiten möchte, sollte darauf achten, ob die benötigten Bibliotheken (z.B. für Datenbank, Netzwerk, usw.) KMP unterstützen. Dazu eine hilfreiche Sammlung: https://github.com/terrakok/kmp-awesome

## UI, Layout, Styling, State

Wie in Android?

## Data

Room wie in Android?

## Navigation

Wie in Android?

Support für Navigation 3 in KMP: https://youtrack.jetbrains.com/issue/CMP-7646/Support-Navigation-3-for-Compose-Multiplatform

## Links

Sammlung:

- Docs von Jetbrains: https://www.jetbrains.com/kotlin-multiplatform/
- Android Developer Docs: https://developer.android.com/kotlin/multiplatform
- Kotlin Docs: https://kotlinlang.org/docs/multiplatform.html

Codelabs:

- https://developer.android.com/codelabs/kmp-migrate-room

Sample Apps:

- https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-samples.html

Auflistung von Bibliotheken, die KMP unterstützen: https://github.com/terrakok/kmp-awesome

Siehe auch die Lernressourcen zu Kotlin und Android in den vorherigen Seiten.